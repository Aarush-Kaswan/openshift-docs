:_content-type: ASSEMBLY
[id="microshift-4-14-release-notes"]
= {product-title} {product-version} release notes
include::_attributes/attributes-microshift.adoc[]
:context: release-notes

toc::[]

{product-title} provides developers and IT organizations with small-form-factor and edge computing, delivered as an application that customers can deploy on top of their managed {op-system-base-full} devices at the edge. Built on {OCP} and Kubernetes, {microshift-short} provides an efficient way to operate single-node clusters in low-resource edge environments.

{microshift-short} is designed to make control plane restarts economical and be lifecycle-managed as a single unit by the operating system. Updates, roll-backs, and configuration changes consist of simply staging another version in parallel and then - without relying on a network - flipping to and from that version and restarting.

[id="microshift-4-14-about-this-release"]
== About this release
// TODO: Update with the relevant information closer to release.
{microshift-short} was introduced as Technology Preview in version 4.13 and is now Generally Available with {microshift-short} 4.14. Support for {microshift-short} 4.13 is planned to end in a future {microshift-short} release. You should plan to update to the latest version of {microshift-short}. This release uses link:https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.27.md[Kubernetes 1.27] with CRI-O runtime. New features, changes, and known issues that pertain to {product-title} {microshift-short} are included in this topic.

You can deploy {microshift-short} clusters to either on-premise, cloud, or disconnected environments.

// Double check OP system versions
{microshift-short} {product-version} is supported on {op-system-ostree-first} and {op-system-base-full} 9.2.

//TODO: update link after GA; KCS article will not be live until then
//For lifecycle information, see the link:https://access.redhat.com/support/policy/updates/openshift[Red Hat {product-title} Life Cycle Policy].

[id="microshift-4-14-new-features-and-enhancements"]
== New features and enhancements

This release adds improvements related to the following components and concepts.

//L3 major categories with features in each as L4s, for example:
[id="microshift-4-14-rhel"]
=== {op-system-base-full} {op-system-version}
* {microshift-short} runs on {op-system-base-full} version 9.2.

// Some details of the next note are adapted from https://kubernetes.io/blog/2022/08/31/cgroupv2-ga-1-25/
* {microshift-short} uses crun and Control Group v2 (cgroup v2). {OCP} {ocp-version} defaults to Control Group v1. The divergence of control group versions is not anticipated to have a noticeable behavior difference on most workloads. If workloads rely on the cgroup file system layout, they may need to be updated to be compatible with cgroup v2.

** If you run third-party monitoring and security agents that depend on the cgroup file system, update the agents to versions that support cgroup v2.
** If you run cAdvisor as a standalone DaemonSet for monitoring pods and containers, update it to v0.43.0 or later.
** If you deploy Java applications with the JDK, ensure you are using JDK 11.0.16 and later or JDK 15 and later, which fully support cgroup v2.

[id="microshift-4-14-updating"]
=== Updating
With this release, updates for both minor releases and patch releases are supported.

[id="microshift-4-14-updates-supported"]
==== Updates are supported on {product-version} and later
The following list provides update details:

* {microshift-short} offers in-place updates on {op-system-ostree} systems with automatic system rollback capabilities and automatic back up and restore functions.
* Updates of the RPMs on a non-OSTree system such as {op-system} are also supported.
* Updates from preview versions such as {microshift-short} 4.13 and earlier are not supported.

//[id="microshift-4-14-new-feat-based-on-{op-system-ostree}"]
//==== Placeholder for new feat bases on RHEL Edge

//[id="microshift-4-14-installation"]
//=== Installation

//[id="microshift-4-14-new-feature-for-use-at-installation"]
//==== New feature for use during installation here
//can include a note about a change in base RHEL image

//[id="microshift-4-14-support"]
//=== Support

[id="microshift-4-14-post-installation"]
=== Post-installation configuration
With this release, configuration options have changed.

[id="microshift-4-14-changes-config-yaml"]
==== Configuration options changes
* File placement for a custom YAML is now only in the `/etc/microshift/` directory. The `$HOME/.microshift/` directory is no longer used.
* The `clusterNetwork` field format has changed from a list of structures with a `cidr` field to a list of strings containing CIDR values.
* The `advertiseAddress` field was added.

See xref:../microshift_configuring/microshift-using-config-tools.adoc#microshift-yaml-default_microshift-using-config-tools[using configuration tools] for details.

//[id="microshift-4-14-administrator-perspective"]
//==== Administrator Perspective
//admin perspectives go here

//[id="microshift-4-14-security"]
//=== Security and compliance
//
// This content will be added post-GA, as it is asynchronous content.

//[id="microshift-4-14-networking"]
//=== Networking

//[id="microshift-4-14-load-balancer"]
//==== Deploying network load balancers on {product-title}

[id="microshift-4-14-storage"]
=== Storage
With this release, the Migrator Controller embedded in {microshift-short} is used to update stored data to the latest storage version. You can update data without having to recreate custom resources (CRs). See xref:../microshift_storage/microshift-storage-migration.adoc#microshift-storage-migration[Storage migration using the Kube Storage Version Migrator] for details.

[id="microshift-backup-and-restore"]
=== Backup and restore
The capability to back up and restore the {microshift-short} database is now available. You can manually back up and restore data on all supported systems at any time. See xref:../microshift_backup_and_restore/microshift-backup-and-restore.adoc#microshift-backup-and-restore[Backing up and restoring {product-title} data] for more information.

//[id="microshift-4-14-running-apps"]
//=== Running Applications
//still need to add

//[id="microshift-4-14-lvms-system-requirements"]
//==== LVMS system requirements

[id="microshift-4-14-deprecated-and-removed"]
== Deprecated and removed features

Some features available in previous releases of {microshift-short} have been deprecated or removed.

Deprecated functionality is still included in {microshift-short} and continues to be supported; however, it will be removed in a future release of this product and is not recommended for new deployments. For the most recent list of major functionality deprecated and removed within {microshift-short} {product-version}, refer to the tables below. Additional details for more functionality that has been deprecated and removed are listed after the table.

In the following tables, features are marked with the following statuses:

* _Available_

* _Deprecated_

* _Removed_

.{product-title} deprecated and removed features tracker
[cols="4,1,1,1",options="header"]
|====
|Feature |4.12 |4.13 | 4.14

|Network configuration flags
|-
|Deprecated
|Removed

|CIDR notation
|-
|-
|Removed

|====
[discrete]
[id="microshift-4-14-network-config-flags-removed"]
==== Network configuration flags are removed

The gateway bridge flag, 'gatewayInterface', and the OVS flag, `disableOVSInit`, in the networking configuration file, `/etc/microshift/ovn.yaml`, are removed with this release. See the xref:../microshift_networking/microshift-networking-settings.adoc#microshift-config-OVN-K_microshift-networking[{microshift-short} OVN-K configuration] documentation for more information.

[discrete]
[id="microshift-4-14-cidr-removal"]
==== CIDR notation removed from configuration

The CIDR notation for grouping IP addresses was removed from the `clusterNetwork` configuration. The `clusterNetwork` field format has changed from a list of structures with a `CIDR` field to a list of strings containing `CIDR` values. For an example, see the xref:../microshift_configuring/microshift-using-config-tools.adoc#microshift-yaml-default_microshift-using-config-tools[Using configuration tools] documentation.

[id="microshift-4-14-bug-fixes"]
== Bug fixes

* Before this update, {microshift-short} automatically adjusted the maximum memory limit for etcd to match the minimum supported level if the value in the configuration file was too small. With this update, {microshift-short} enforces valid configuration by exiting with an error if the memory limit for etcd is set below the minimum allowed value of 128 MB. (link:https://issues.redhat.com/browse/OCPBUGS-11592[*OCPBUGS-11592*])

* Previously, certificate authorities generated `kubeconfig` files for the embedded components of {microshift-short}. With this update, certificate authorities are reconfigured to ensure the `kubeconfig` files are independent. (link:https://issues.redhat.com/browse/OCPBUGS-8301[*OCPBUGS-8301*])

* Previously, the sos wrapper helper was not present and the sos command had to be run manually. With this update, the sos wrapper is added to {microshift-short} and you do not need to run the sos command manually when debugging. (link:https://issues.redhat.com/browse/OCPBUGS-19772[*OCPBUGS-19772*])

* Previously, {microshift-short} did not generate version details at startup. With this update, {microshift-short} now logs version details at startup. (link:https://issues.redhat.com/browse/OCPBUGS-19638[*OCPBUGS-19638*])

* Previously, node IP certificates continued to use the previous IP address when the IP address changed, causing external certificates not to verify against the new IP address. With this update, certificates update when the node IP changes. (link:https://issues.redhat.com/browse/OCPBUGS-19315[*OCPBUGS-19315*])

* Previously, after changing the IP adddress, previous `kubeconfig` files for the previous IP address remained. These `kubeconfig` files were unusable because they targeted an IP address not used by {microshift-short}. With this update, the `kubeconfig` files associated with the previous IP address are deleted when the IP address changes. (link:https://issues.redhat.com/browse/OCPBUGS-15740[*OCPBUGS-15740*])

* Previously, KCM and KAS did not exit after getting a cancellation signal. With this update, {microshift-short} shuts down as expected. (link:https://issues.redhat.com/browse/OCPBUGS-18773[*OCPBUGS-18773*])

* Previously, when stopping `microshift.service`, `microshift-etcd.scope` was also signaled to stop which caused etcd to stop too soon. With this update, the issue that prevented the etcd database from shutting down in the correct order is resolved. (link:https://issues.redhat.com/browse/OCPBUGS-14678[*OCPBUGS-14678*])

* Previously, the `microshift show-config` command did not show configuration changes. With this update, the behavior of the `microshift show-config` command shows the current configuration by default. (link: https://issues.redhat.com/browse/OCPBUGS-13221[*OCPBUGS-13221*])

* Previously, the `externalGatewayInterface` flag was used to specify the interface to be added to the OVS gateway bridge `br-exl` to be used as a second gateway interface. When {microshift-short} switched to the OVN-K local gateway mode. All pods-to-external traffic now goes through the host kernal before entering or leaving the host. With this update, the unused `externalGatewayInterface` configuration parameter from the `ovn.yaml` file for the CNI driver is removed. (link:https://issues.redhat.com/browse/OCPBUGS-13078[*OCPBUGS-13078*])

* Previously, the search logic for directories with `kustomization` files searched for `kustomization.yaml`. `kubectl` also searches for `kustomization.yaml` and `kustomization`. With this update, the search logic is extended for manifest input files to include `kustomization.yml` and `kustomization` in addition to the existing `kustomization.yaml`. (link:https://issues.redhat.com/browse/OCPBUGS-12744[*OCPBUGS-12744*])

* Previously, {microshift-short} healthcheck produced logs that were not linked to the `systemd` unit, which made them hard to find. With this update, the logs are linked to the unit making them easier to access. (link:https://issues.redhat.com/browse/OCPBUGS-20174[*OCPBUGS-20174*])

* Previously, the host needed a volume group named `rhel` in order for the driver to work. With this update, {microshift-short} examines volume groups that exist and selects one as the default. If there is only 1 volume group, that one is used. If there are multiple volume groups and one is named `microshift`, the `microshift` volume group is used. The CSI driver must be explicitly enabled if no volume groups exist. (link:https://issues.redhat.com/browse/OCPBUGS-9996[*OCPBUGS-9996*])

* Previously, mixing upper and lower case letters in the hostname makes {microshift-short} fail. This is because the node name was taken directly from the hostname, and Kubernetes does not allow upper case names. With this update, the hostname only uses lower case host names. (link:https://issues.redhat.com/browse/OCPBUGS-8411[*OCPBUGS-8411*])

* Previously, the log output volume of the `sysconfwatch-controller` contained duplicate messages. With this update, the log output volume for the `sysconfwatch-controller` was reduced to avoid filling the journal with duplicate messages. (link:https://issues.redhat.com/browse/OCPBUGS-8329[*OCPBUGS-8329*])

* Previously, kubeconfigs used a certificate authority (CA) bundle that included 3 different signers: service network, localhost, and external. This made kubeconfigs interchangeable and capable of validating for other networks. With this update, the certificate authorities used to generate kubeconfig files for {microshift-short}'s embedded components were reconfigured to ensure the kubeconfigs are independent. (link:https://issues.redhat.com/browse/OCPBUGS-8301[*OCPBUGS-8301*])

* Previously, an internal apiserver IP address was configured in a loopback device to fix certificate issues. As a result, OVN-Kubernetes picks up this virtual IP address as an apiserver backend making it unreachable. With this update, use a different virtual IP address to configure a loopback device. (link:https://issues.redhat.com/browse/OCPBUGS-8277[*OCPBUGS-8277*])

* Previously, CRI-O was not configured with the correct default path to pause the container because pods with `shareProcessNamespace` set to `true` could not start. With this update, CRI-O is configured explicitly with the correct path. (link:https://issues.redhat.com/browse/OCPBUGS-7874[*OCPBUGS-7874*])

* Previously, the mDNS server in {microshift-short} was advertising all IP addresses on the host. As a result, clients relying on mDNS to resolve the hostname for a route might have been given an internal IP address that could not be used by an application running on {microshift-short}. With this update, the mDNS server in {microshift-short} advertises internal IP addresses. (link:https://issues.redhat.com/browse/OCPBUGS-7205[*OCPBUGS-7205*])

* Previously, using a `.local` suffix for a hostname broke the name resolution with DNS. As a result, {microshift-short} was unable to reach its own hostname. With this update, mDNS was fixed to use IP addresses instead of hostnames whenever possible. (link:https://issues.redhat.com/browse/OCPBUGS-10766[*OCPBUGS-10766*])

* Previously, when IP addresses were used instead of hostnames to connect to the apiserver, external connectivity failed. As a result, certificates did not regenerate when the IP address was changed. The kubeconfig used names instead of IP addresses which required the use of `subjectAltNames` if IP addresses were alternativly used. With this update, the previous kubeconfigs for absent IP addresses and names are removed. (link:https://issues.redhat.com/browse/OCPBUGS-11395[*OCPBUGS-11395*])

* Previously, installing EC builds of {microshift-short} on {op-system-base-full} 9.2 required OpenvSwitch 2.17, but {op-system} 9.2 includes OpenvSwitch 3.x by default. With this update, {microshift-short} works with OpenvSwitch 3.x on {op-system} 9.2 and later. (link:https://issues.redhat.com/browse/OCPBUGS-11538[*OCPBUGS-11538*])

* Previously, the command `microshift show-config` was prevented from reporting the correct `memoryLimitMB` for etcd. With this update, `microshift show-config` reports the correct `memoryLimitMB` for etcd. (link:https://issues.redhat.com/browse/OCPBUGS-11734[*OCPBUGS-11734*])

* Previously, OVN-Kubernetes failed to run on a disconnected {microshift-short} instance. With this update, the OVN-Kubernetes configuration supports running {microshift-short} on hosts with no default route. (link:https://issues.redhat.com/browse/OCPBUGS-11967[*OCPBUGS-11967*])

* Previously, the networking smoke test created a `hello-microshift` pod using `busybox` and an image pulled from docker. With this update, quay.io is used to host the image. (link:https://issues.redhat.com/browse/OCPBUGS-19939[*OCPBUGS-19939*])

[id="microshift-4-14-known-issues"]
== Known issues

* OVN-Kubernetes sets up an iptable chain in the network address translation (NAT) table to handle incoming traffic to the NodePort service. When the NodePort service is not reachable or the connection is refused, check the iptable rules on the host to make sure the relevant rules are properly inserted.
+
. View the iptable rules for the NodePort service by running the following command:
+
[source, terminal]
----
$ sudo iptables-save | grep NODEPORT
----
+
.Example output
[source, terminal]
----
-A OUTPUT -j OVN-KUBE-NODEPORT
-A OVN-KUBE-NODEPORT -p tcp -m addrtype --dst-type LOCAL -m tcp --dport 30326 -j DNAT --to-destination 10.43.95.170:80
----
OVN-Kubernetes configures the `OVN-KUBE-NODEPORT` iptable chain in the NAT table to match the packet with the destination port and Destination Network Address Translates (DNATs) the packet to the `clusterIP` service. The packet is then routed to the OVN network through the gateway bridge `br-ex` using routing rules on the host.
+
. View the hosts routing table by running the following command:
+
[source, terminal]
----
$ ip route
----
+
.Example output
[source, terminal]
----
10.43.0.0/16 via 192.168.122.1 dev br-ex mtu 1400
----
This routing rule matches the Kubernetes service IP address range and forwards the packet to the gateway bridge `br-ex`. You must enable `ip_forward` on the host. After the packet is forwarded to the OVS bridge `br-ex`, it is handled by OpenFlow rules in OVS. OpenFlow then steers the packet to the OVN network and eventually to the pod.

[id="microshift-4-14-notable-technical-changes"]
== Notable technical changes

{microshift-short} {product-version} introduces the following notable technical changes.
// Note: use [discrete] for these sub-headings.

[discrete]
[id="microshift-4-14-networking-changes"]
=== Networking changes

Networking updates to {microshift-short} {product-version} include traffic flow pattern, gateway, and custom configuration changes.

[discrete]
[id="microshift-4-14-traffic-flow-change"]
==== North-south traffic flow changed

The external gateway bridge and the physical device on the host are no longer connected. The north-south traffic between the network service and the OVN external switch flows from the host kernel to {microshift-short} through the external gateway bridge. See the xref:../microshift_networking/microshift-cni.adoc#microshift-network-topology_microshift-networking[About the OVN-Kubernetes network plugin] documentation for more information.

[id="microshift-4-14-asynchronous-errata-updates"]
== Asynchronous errata updates

Security, bug fix, and enhancement updates for {microshift-short} {product-version} are released as asynchronous errata through the Red Hat Network. All {microshift-short} {product-version} errata are https://access.redhat.com/downloads/content/290/[available on the Red Hat Customer Portal]. Read the https://access.redhat.com/support/policy/updates/openshift[{microshift-short} Life Cycle] for more information about asynchronous errata.

Red Hat Customer Portal users can enable errata notifications in the account settings for Red Hat Subscription Management (RHSM). When errata notifications are enabled, you are notified through email whenever new errata relevant to your registered systems are released.

[NOTE]
====
Red Hat Customer Portal user accounts must have systems registered and consuming {microshift-short} entitlements for {microshift-short} errata notification emails to generate.
====

This section is updated over time to provide notes on enhancements and bug fixes for future asynchronous errata releases of {microshift-short} {ocp-version}. Versioned asynchronous releases, for example with the form {microshift-short} {ocp-version}.z, will be detailed in the following subsections.

[id="microshift-4-14-0-dp"]
=== RHSA-2023:5008 - {microshift-short} 4.14.0 bug fix and security update advisory

Issued: 2023-10-31

{product-title} release 4.14.0 is now available. The list of bug fixes that are included in the update is documented in the link:https://access.redhat.com/errata/RHSA-2023:5008[RHSA-2023:5008] advisory. The images that are included in the update are provided by the link:https://access.redhat.com/errata/RHSA-2023:5006[RHSA-2023:5006] advisory.

For the `TopoLVM image`, see link:https://catalog.redhat.com/software/containers/lvms4/topolvm-rhel9/63972de3adcb55263891b983?container-tabs=dockerfile[lvms4/topolvm-rhel9].