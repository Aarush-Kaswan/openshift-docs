:_mod-docs-content-type: ASSEMBLY   
include::_attributes/common-attributes.adoc[]
[id="managing-apps-in-non-control-plane-namespaces"]
= Managing the application resources in non-control plane namespaces
:context: managing-apps-in-non-control-plane-namespaces

toc::[]

As a cluster administrator, you can create and manage the `Application` resources in non-control plane namespaces declaratively other than the `openshift-gitops` control plane namespace. This functionality is called the _Applications in any namespace_ feature in the Argo CD open source project.

[NOTE]
====
As a developer, if you are creating Argo CD applications in non-control plane namespaces other than the `openshift-gitops` control plane namespace, ensure that your cluster administrator grants the necessary permissions to them.

Otherwise, after the Argo CD reconciliation, you will see an error message similar to the following example:

.Example error message

[source,terminal]
----
error while validating and normalizing app: error getting application's project: application 'app' in namespace 'dev' is not allowed to use project 'default'
----
====

To use this functionality, you must explicitly enable and configure the target namespaces in the following objects:

* The `ArgoCD` custom resource (CR) of your user-defined cluster-scoped Argo CD instance
* The `AppProject` custom resource (CR)
* The `Application` CR

The process of creating and managing the `Application` resources in non-control plane namespaces consists of the following procedures:

. xref:../argocd_applications/managing-apps-in-non-control-plane-namespaces.adoc#gitops-configuring-argo-cd-cr-of-your-user-defined-cluster-scoped-instance-with-target-namespaces_managing-apps-in-non-control-plane-namespaces[Configuring the `ArgoCD` CR of your user-defined cluster-scoped Argo CD instance with the target namespaces].
. xref:../argocd_applications/managing-apps-in-non-control-plane-namespaces.adoc#gitops-creating-and-configuring-user-defined-appproject-instance-with-target-namespaces_managing-apps-in-non-control-plane-namespaces[Creating and configuring a user-defined `AppProject` instance in the `openshift-gitops` control plane namespace and specify the target namespaces in the `.spec.sourceNamespaces` field of the user-defined `AppProject` instance].
. xref:../argocd_applications/managing-apps-in-non-control-plane-namespaces.adoc#gitops-creating-and-configuring-the-app-cr-to-reference-the-target-namespace-and-user-defined-appproject-instance_managing-apps-in-non-control-plane-namespaces[Configuring the `metadata.namespace` and `.spec.project` fields of the `Application` CR to reference the target namespaces and user-defined `AppProject` instance]. 

This functionality is useful in multitenancy environments when you want to manage deployments of Argo CD applications for your isolated teams.

[IMPORTANT]
====
To prevent privilege escalations for your application teams, you must meet the following requirements:

* Do not configure non-control plane namespaces in the `.spec.sourceNamespaces` field of any privileged `AppProject` instance, for example, the `default` instance of your `AppProject` CR installed in either the `openshift-gitops` control plane namespace or your defined namespace.
* Do not grant access to the `openshift-gitops` control plane namespace within the `AppProject` CRD. 
* Always create and configure user-defined `AppProject` instances in the `openshift-gitops` control plane namespace, and then configure non-control plane namespaces in the `.spec.sourceNamespaces` field within the corresponding user-defined `AppProject` instance.
====

[id="prerequisites_{context}"]
== Prerequisites

* You have installed {gitops-title} 1.13.0 or a later version on your {OCP} cluster.
* You have a user-defined xref:../declarative_clusterconfig/configuring-an-openshift-cluster-by-deploying-an-application-with-cluster-configurations.adoc#using-argo-cd-instance-to-manage-cluster-scoped-resources_configuring-an-openshift-cluster-by-deploying-an-application-with-cluster-configurations[cluster-scoped Argo CD instance] in your defined namespace, for example, `spring-petclinic` namespace.

// Configuring the Argo CD CR of your user-defined cluster-scoped Argo CD instance with the target namespaces
include::modules/gitops-configuring-argo-cd-cr-of-your-user-defined-cluster-scoped-instance-with-target-namespaces.adoc[leveloffset=+1]
[role="_additional-resources"]
.Additional resources
* xref:../argocd_instance/setting-up-argocd-instance.adoc#setting-up-argocd-instance[Installing a user-defined Argo CD instance]

// Creating and configuring a user-defined AppProject instance with the target namespaces
include::modules/gitops-creating-and-configuring-user-defined-appproject-instance-with-target-namespaces.adoc[leveloffset=+1]

// Creating and configuring the Application CR to reference the target namespace and user-defined AppProject instance
include::modules/gitops-creating-and-configuring-the-app-cr-to-reference-the-target-namespace-and-user-defined-appproject-instance.adoc[leveloffset=+1]

[role="_additional-resources"]
[id="additional-resources_{context}"]
== Additional resources

* xref:../declarative_clusterconfig/configuring-an-openshift-cluster-by-deploying-an-application-with-cluster-configurations.adoc#creating-an-application-by-using-the-argo-cd-dashboard_configuring-an-openshift-cluster-by-deploying-an-application-with-cluster-configurations[Creating an application by using the Argo CD dashboard]
* xref:../argocd_application_sets/managing-app-sets-in-non-control-plane-namespaces.adoc#managing-app-sets-in-non-control-plane-namespaces[Managing the application set resources in non-control plane namespaces]
