// Module included in the following assembly:
//
// * declarative_clusterconfig/customizing-permissions-by-creating-user-defined-cluster-roles-for-cluster-scoped-instances.adoc

:_mod-docs-content-type: PROCEDURE
[id="gitops-customizing-permissions-for-cluster-scoped-instances_{context}"]
= Customizing permissions for cluster-scoped instances

As a cluster administrator, to customize permissions for cluster-scoped instances, you must create new cluster roles and cluster role bindings for the {gitops-shortname} control plane components. 

For example purposes, the following instructions focus only on user-defined cluster-scoped instances.

.Procedure

. Open the *Administrator* perspective of the web console and go to *User Management* -> *Roles* -> *Create Role*.

. Use the following `ClusterRole` YAML template to add rules to specify the additional permissions.
+
.Example cluster role YAML template

[source,yaml]
----
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: example-spring-petclinic-argocd-application-controller # <1>
rules:
  - verbs:
      - get
      - list
      - watch
    apiGroups:
      - '*'
    resources:
      - '*'
  - verbs:
      - '*'
    apiGroups:
      - ''
    resources: # <2>
      - namespaces 
      - persistentvolumes 
----
<1> The name of the cluster role according to the <argocd_name>-<argocd_namespace>-<control_plane_component> naming convention.
<2> The resources to which you want to grant permissions at the cluster level.

. Click *Create* to add the cluster role.

. Find the service account used by the control plane component you are customizing permissions for, by performing the following steps:
+
.. Go to *Workloads* -> *Pods*.
.. From the *Project* drop-down menu, select the project where the user-defined cluster-scoped instance is installed.
.. Click the pod of the control plane component and go to the *YAML* tab.
.. Find the `spec.ServiceAccount` field and note the service account.

. Go to *User Management* -> *RoleBindings* -> *Create binding*.

. Click *Create binding*.

. Select *Binding type* as *Cluster-wide role binding (ClusterRoleBinding)*.

. Enter a unique value for *RoleBinding name* by following the <argocd_name>-<argocd_namespace>-<control_plane_component> naming convention.

. Select the newly created cluster role from the drop-down list for *Role name*.

. Select the *Subject* as *ServiceAccount* and the provide the *Subject namespace* and *name*.
.. *Subject namespace*: `spring-petclinic`
.. *Subject name*: `example-argocd-application-controller`
+
[NOTE]
====
For *Subject name*, ensure that the value you configure is the same as the value of the `spec.ServiceAccount` field of the control plane component you are customizing permissions for.
====

. Click *Create*. 
+
You have created the required permissions for the control plane component's service account and namespace. The YAML file for the `ClusterRoleBinding` object looks similar to the following example:
+
.Example YAML file for a cluster role binding

[source,yaml]
----
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: example-spring-petclinic-argocd-application-controller
subjects:
  - kind: ServiceAccount
    name: example-argocd-application-controller
    namespace: spring-petclinic
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: example-spring-petclinic-argocd-application-controller
----
