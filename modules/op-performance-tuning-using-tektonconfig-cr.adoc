// This module is included in the following assemblies:
// * install_config/installing-pipelines.adoc

:_mod-docs-content-type: REFERENCE
[id="op-performance-tuning-using-tektonconfig-cr_{context}"]
= Performance tuning using TektonConfig CR

You can modify the fields under the `.spec.pipeline.performance` parameter in the `TektonConfig` custom resource (CR) to change high availability (HA) support and performance configuration for the {pipelines-shortname} controller.

.Example TektonConfig performance fields
[source,yaml]
----
apiVersion: operator.tekton.dev/v1alpha1
kind: TektonConfig
metadata:
  name: config
spec:
  pipeline:
    performance:
      disable-ha: false
      buckets: 7
      replicas: 5
      threads-per-controller: 2
      kube-api-qps: 5.0
      kube-api-burst: 10
----

All fields are optional. If you set them, the {pipelines-title} Operator includes most of the fields as arguments in the `openshift-pipelines-controller` deployment under the `openshift-pipelines-controller` container. The {pipelines-shortname} Operator also updates the `buckets` field in the `config-leader-election` configuration map under the `openshift-pipelines` namespace.

If you do not specify the values, the {pipelines-shortname} Operator does not update those fields and applies the default values for the {pipelines-shortname} controller.

[NOTE]
====
If you modify or remove any of the performance fields, the {pipelines-shortname} Operator updates the `openshift-pipelines-controller` deployment and the `config-leader-election` configuration map (if the `buckets` field changed) and re-creates `openshift-pipelines-controller` pods.
====

High-availability (HA) mode applies to the {pipelines-shortname} controller, which creates and starts pods based on pipeline run and task run definitions. Without HA mode, a single pod executes these operations, potentially creating significant delays under a high load.

In HA mode, {pipelines-shortname} uses several pods (replicas) to execute these operations. Initially, {pipelines-shortname} assigns every controller operation into a bucket. Each replica picks operations from one or more buckets. If two replicas could pick the same operation at the same time, the controller internally determines a _leader_ that executes this operation.

HA mode does not affect execution of task runs after the pods are created.

.Modifiable fields for tuning {pipelines-shortname} performance
[options="header"]
|===

| Name | Description | Default value for the {pipelines-shortname} controller

| `disable-ha` | Enable or disable the high availability (HA) mode. By default, the HA mode is enabled. | `false`

| `buckets` | In HA mode, the number of buckets used to process controller operations. The maximum value is `10` | `1`

| `replicas` | In HA mode, the number of pods created to process controller operations. Set this value to the same or lower number than the `buckets` value. | `1`

| `threads-per-controller` | The number of threads (workers) to use when the work queue of the {pipelines-shortname} controller is processed. | `2`

| `kube-api-qps` | The maximum queries per second (QPS) to the cluster master from the REST client. | `5.0`

| `kube-api-burst` | The maximum burst for a throttle. | `10`

|===

[NOTE]
====
The {pipelines-shortname} Operator does not control the number of replicas of the {pipelines-shortname} controller. The `replicas` setting of the deployment determines the number of replicas. For example, to change the number of replicas to 3, enter the following command:

[source,terminal]
----
$ oc --namespace openshift-pipelines scale deployment openshift-pipelines-controller --replicas=3
----
====

[IMPORTANT]
====
The `kube-api-qps` and `kube-api-burst` fields are multiplied by 2 in the {pipelines-shortname} controller. For example, if the `kube-api-qps` and `kube-api-burst` values are `10`, the actual QPS and burst values become `20`.
====
