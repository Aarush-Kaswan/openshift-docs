// Module included in the following assemblies:
//
// * updating/update-using-custom-machine-config-pools.adoc

:_mod-docs-content-type: CONCEPT
[id="update-using-custom-machine-config-pools-about_{context}"]
= About performing a canary rollout update

The following steps outline the high-level workflow of the canary rollout update process:

. Create custom machine config pools (MCP) based on the worker pool.
+
[NOTE]
====
You can change the `maxUnavailable` setting in an MCP to specify the percentage or the number of machines that can be updating at any given time. The default is `1`.
====

. Add a node selector to the custom MCPs. For each node that you do not want to update simultaneously with the rest of the cluster, add a matching label to the nodes. This label associates the node to the MCP.
+
[IMPORTANT]
====
Do not remove the default worker label from the nodes. The nodes must have a role label to function properly in the cluster.
====

. Pause the MCPs you do not want to update as part of the update process.
+
[NOTE]
====
Pausing the MCP also pauses the `kube-apiserver-to-kubelet-signer` automatic CA certificates rotation. New CA certificates are generated at 292 days from the installation date and old certificates are removed 365 days from the installation date. See the link:https://access.redhat.com/articles/5651701[Understand CA cert auto renewal in Red Hat OpenShift 4] to find out how much time you have before the next automatic CA certificate rotation.

Make sure the pools are unpaused when the CA certificate rotation happens. If the MCPs are paused, the MCO cannot push the newly rotated certificates to those nodes. This causes the cluster to become degraded and causes failure in multiple `oc` commands, including `oc debug`, `oc logs`, `oc exec`, and `oc attach`. You receive alerts in the Alerting UI of the {product-title} web console if an MCP is paused when the certificates are rotated.
====

. Perform the cluster update. The update process updates the MCPs that are not paused, including the control plane nodes.

. Test your applications on the updated nodes to ensure they are working as expected.

. Unpause one of the remaining MCPs, wait for the nodes in that pool to finish updating, and test the applications on those nodes.
Repeat this process until all worker nodes are updated.

. Optional: Remove the custom label from updated nodes and delete the custom MCPs.
