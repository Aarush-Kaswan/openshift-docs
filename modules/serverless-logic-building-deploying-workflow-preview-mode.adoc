// Module included in the following assemblies:
//
// * serverless/serverless-logic/serverless-logic-creating-managing-workflows.adoc

:_mod-docs-content-type: PROCEDURE
[id="serverless-logic-building-deploying-workflow-preview-mode_{context}"]
= Building and deploying your workflow

You can create a `SonataFlow` custom resource (CR) on {ocp-product-title} and {ServerlessLogicOperatorName} builds and deploys the workflow. 

.Prerequisites

* You have an {ServerlessLogicOperatorName} installed on your cluster.
* You have access to an {ServerlessLogicProductName} project with the appropriate roles and permissions to create applications and other workloads in {ocp-product-title}.
* You have installed the OpenShift CLI `(oc)`.

.Procedure

. Create a workflow YAML file similar to the following:
+
[source,yaml]
----
apiVersion: sonataflow.org/v1alpha08
kind: SonataFlow
metadata:
  name: greeting
  annotations:
    sonataflow.org/description: Greeting example on k8s!
    sonataflow.org/version: 0.0.1
spec:
  flow:
    start: ChooseOnLanguage
    functions:
      - name: greetFunction
        type: custom
        operation: sysout
    states:
      - name: ChooseOnLanguage
        type: switch
        dataConditions:
          - condition: "${ .language == \"English\" }"
            transition: GreetInEnglish
          - condition: "${ .language == \"Spanish\" }"
            transition: GreetInSpanish
        defaultCondition: GreetInEnglish
      - name: GreetInEnglish
        type: inject
        data:
          greeting: "Hello from JSON Workflow, "
        transition: GreetPerson
      - name: GreetInSpanish
        type: inject
        data:
          greeting: "Saludos desde JSON Workflow, "
        transition: GreetPerson
      - name: GreetPerson
        type: operation
        actions:
          - name: greetAction
            functionRef:
              refName: greetFunction
              arguments:
                message:  ".greeting+.name"
        end: true
----

. Apply the `SonataFlow` workflow definition to your {ocp-product-title} namespace by running the following command:
+
[source,terminal]
----
$ oc apply -f <workflow-name>.yaml -n <your_namespace>
----
+
.Example command for the `greetings-workflow.yaml` file:
[source,terminal]
----
$ oc apply -f greetings-workflow.yaml -n workflows
----

. List all the build configurations by running the following command:
+
[source,terminal]
----
$ oc get buildconfigs -n workflows
----

. Get the logs of the build process by running the following command:
+
[source,terminal]
----
$ oc logs buildconfig/<workflow-name> -n <your_namespace>
----
+
.Example command for the `greetings-workflow.yaml` file:
[source,terminal]
----
$ oc logs buildconfig/greeting -n workflows
----

.Verification

. To verify the deployment, list all the pods by running the following command:
+
[source,terminal]
----
$ oc get pods -n <your_namespace>
----
+
Ensure that the pod corresponding to your workflow is running.

. Check the running pods and their logs by running the following command:
+
[source,terminal]
----
$ oc logs pod/<pod-name> -n workflows
----