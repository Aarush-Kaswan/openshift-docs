// This module is included in the following assembly:
//
// builds/configuring-openshift-builds.adoc

:_content-type: CONCEPT
[id="example-configuration-for-defining-parameter-values_{context}"]
= Example configuration for defining parameter values

The following examples show how to define parameters in a build strategy and assign values to those parameters by using a `Build` CR. You can also assign values to the `build-args` parameter, which can be a config map, secret, or hard-coded value.

.Example: Defining parameters in a `ClusterBuildStrategy` CR
The following example shows a `ClusterBuildStrategy` CR that defines several parameters:

[source,yaml]
----
apiVersion: shipwright.io/v1beta1
kind: ClusterBuildStrategy
metadata:
  name: buildkit
  # ...
spec:
  parameters:
  - name: build-args
    description: "The ARG values in the format KEY=VALUE."
    type: array
    defaults: []
  - name: cache
    description: "Configure BuildKit's cache usage."
    type: string
    default: registry
  # ...
  steps:
  # ...
----

.Example: Assigning values to parameters in a `Build` CR
The above `ClusterBuildStrategy` CR defines a `cache` parameter and you can specify the value of the `cache` parameter in your `Build` CR, as shown in the following example:

[source,yaml]
----
apiVersion: shipwright.io/v1beta1
kind: Build
metadata:
  name: a-build
  namespace: a-namespace
spec:
  paramValues:
  - name: cache
    value: disabled
  strategy:
    name: buildkit
    kind: ClusterBuildStrategy
  source:
  # ...
  output:
  # ...
----

.Example: Creating a `ConfigMap` CR to control a parameter centrally
If you want to use the `cache` parameter for multiple builds and control its usage centrally, then you can create a `ConfigMap` CR, as shown in the following example:

[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: buildkit-configuration
  namespace: a-namespace
data:
  cache: disabled
----

You can use the created `ConfigMap` CR as a parameter value in your `Build` CR, as shown in the following example:

[source,yaml]
----
apiVersion: shipwright.io/v1beta1
kind: Build
metadata:
  name: a-build
  namespace: a-namespace
spec:
  paramValues:
  - name: cache
    configMapValue:
      name: buildkit-configuration
      key: cache
  strategy:
    name: buildkit
    kind: ClusterBuildStrategy
  source:
  # ...
  output:
  # ...
----

.Example: Defining a `build-args` parameter in a `Build` CR
You can define a `build-args` parameter as an array. For example, if you use the `buildkit` strategy, you can define a `build-args` parameter to set the argument values in the container file. Values must be defined in the `KEY=VALUE` format as shown in the following example:

[source,yaml]
----
apiVersion: shipwright.io/v1beta1
kind: Build
metadata:
  name: a-build
  namespace: a-namespace
spec:
  paramValues:
  - name: cache
    configMapValue:
      name: buildkit-configuration
      key: cache
  - name: build-args
    values:
    - value: NODE_VERSION=16
  strategy:
    name: buildkit
    kind: ClusterBuildStrategy
  source:
  # ...
  output:
  # ...
----

.Example: Referencing a config map or secret in a `Build` CR
You can also reference config maps or secrets in the `build-args` array parameter as shown in the following example:

[source,yaml]
----
apiVersion: shipwright.io/v1beta1
kind: Build
metadata:
  name: a-build
  namespace: a-namespace
spec:
  paramValues:
  - name: cache
    configMapValue:
      name: buildkit-configuration
      key: cache
  - name: build-args
    values:
    - configMapValue: <1>
        name: project-configuration
        key: node-version
        format: NODE_VERSION=${CONFIGMAP_VALUE}
    - value: DEBUG_MODE=true <2>
    - secretValue: <3>
        name: npm-registry-access
        key: npm-auth-token
        format: NPM_AUTH_TOKEN=${SECRET_VALUE}
  strategy:
    name: buildkit
    kind: ClusterBuildStrategy
  source:
  # ...
  output:
  # ...
----
<1> The first value references a config map. The value used for the `NODE_VERSION` key in the previous example is `16`. So, the `format` field is used to prepend `NODE_VERSION=` to make it a complete key-value pair.
<2> The second value is a hard-coded value.
<3> The third value references a secret.
