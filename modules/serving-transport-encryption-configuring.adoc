// Module included in the following assemblies:
//
// * knative-serving/serving-transport-encryption.adoc
:_content-type: PROCEDURE
[id="serving-transport-encryption-configuring_{context}"]
= Configuring transport encryption

Configuring transport encryption consists of two parts:

. Specifying the `ClusterIssuer` issuer to use:

** `clusterLocalIssuerRef`: issuer for cluster-local-domain certificates used for ingress.

** `systemInternalIssuerRef`: issuer for certificates for system-internal-tls certificates used by Knative internal components.

. Specifying transport encryption features to use:

** `cluster-local-domain-tls`: Enables the transport encryption feature for cluster-local domains

** `system-internal-tls`: Enables the transport encryption feature for OpenShift Serverless Serving internal components.

.Procedure

. Enable transport encryption in the `KnativeServing` resource:
+
[source,yaml]
----
apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
  namespace: knative-serving
spec:
  ...
  config:
    certmanager:
      clusterLocalIssuerRef: |
        kind: ClusterIssuer
        name: knative-serving-ca-issuer <1>
      systemInternalIssuerRef: |
        kind: ClusterIssuer
        name: knative-serving-ca-issuer <2>
    network:
      cluster-local-domain-tls: Enabled <3>
      system-internal-tls: Enabled <4>
----
<1> Define the cluster issuer for each feature. The same or individual cluster issuers can be used.
<2> Define the cluster issuer.
<3> Enable the `cluster-local-domain-tls` feature. This and other features can be enabled or disabled individually.
<4> Enable the `system-internal-tls` feature.

. Apply the `KnativeServing` resource by running the following command:
+
[source,terminal]
----
$ oc apply -f <filename>
----

. Optionally, change the `defaultCertificate` value in the Ingress Controller:
+
[source,yaml]
----
apiVersion: operator.openshift.io/v1
kind: IngressController
 ...
spec:
  defaultCertificate:
    name: ca-ingress-cert
----

. If you changed the `defaultCertificate` value, you must specify the custom certificate name in the `openshift-ingress-default-certificate` field in the `KnativeServing` custom resource. 
+
For example, if the custom certificate name is `ca-ingress-cert`, add the following configuration:
+
[source,yaml]
----
...
spec:
  config:
    network:
      system-internal-tls: Enabled
      openshift-ingress-default-certificate: "ca-ingress-cert"
...
----

. If you enabled `cluster-local-domain-tls` or `system-internal-tls`, restart the Controller component by running the following command.
+
[IMPORTANT]
====
When either the `cluster-local-domain-tls` or the `system-internal-tls` feature is enabled, you must restart the Controller component to enable the Knative Serving `cert-manager` integration.
====
+
[source,terminal]
----
$ oc rollout restart deploy/controller -n knative-serving
----

. If you enabled `system-internal-tls`, restart the Activator component by running the following command.
+
[IMPORTANT]
====
When the `system-internal-tls` feature is activated, you must restart the Activator component to reconfigure its internal web server, as this is not possible during runtime.
====
+
[source,terminal]
----
$ oc rollout restart deploy/activator -n knative-serving
----
