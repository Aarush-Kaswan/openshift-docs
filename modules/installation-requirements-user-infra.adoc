// Module included in the following assemblies:
//
// * installing/installing_bare_metal/installing-bare-metal.adoc
// * installing/installing_bare_metal/installing-bare-metal-network-customizations.adoc
// * installing/installing_bare_metal/installing-restricted-networks-bare-metal.adoc
// * installing/installing_platform_agnostic/installing-platform-agnostic.adoc
// * installing/installing_vmc/installing-restricted-networks-vmc-user-infra.adoc
// * installing/installing_vmc/installing-vmc-user-infra.adoc
// * installing/installing_vmc/installing-vmc-network-customizations-user-infra.adoc
// * installing/installing_vsphere/installing-restricted-networks-vsphere.adoc
// * installing/installing_vsphere/installing-vsphere.adoc
// * installing/installing_vsphere/installing-vsphere-network-customizations.adoc
// * installing/installing_ibm_power/installing-ibm-power.adoc
// * installing/installing_ibm_power/installing-restricted-networks-ibm-power.adoc
// * installing/installing_ibm_z/installing-ibm-z.adoc
// * installing/installing_ibm_z/installing-restricted-networks-ibm-z.adoc

ifeval::["{context}" == "installing-ibm-z"]
:ibm-z:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z"]
:ibm-z:
endif::[]
ifeval::["{context}" == "installing-ibm-power"]
:ibm-power:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-power"]
:ibm-power:
endif::[]
ifeval::["{context}" == "installing-bare-metal"]
:bare-metal:
endif::[]
ifeval::["{context}" == "installing-bare-metal-network-customizations"]
:bare-metal:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-bare-metal"]
:bare-metal:
endif::[]
ifeval::["{context}" == "installing-vsphere"]
:vsphere:
endif::[]
ifeval::["{context}" == "installing-vsphere-network-customizations"]
:vsphere:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-vsphere"]
:vsphere:
endif::[]

[id="installation-requirements-user-infra_{context}"]
= Machine requirements for a cluster with user-provisioned infrastructure

For a cluster that contains user-provisioned infrastructure, you must deploy all
of the required machines.

[id="machine-requirements_{context}"]
== Required machines

The smallest {product-title} clusters require the following hosts:

* One temporary bootstrap machine

* Three control plane, or master, machines

* At least two compute machines, which are also known as worker machines.
ifdef::bare-metal[]
If you are running a three-node cluster, running zero compute machines is supported. Running one compute machine is not supported.
endif::bare-metal[]

[NOTE]
====
The cluster requires the bootstrap machine to deploy the {product-title} cluster
on the three control plane machines. You can remove the bootstrap machine after
you install the cluster.
====

[IMPORTANT]
====
ifdef::ibm-z[]
To improve high availability of your cluster, distribute the control plane machines over different z/VM instances on at least two physical machines.
endif::ibm-z[]
ifndef::ibm-z[]
To maintain high availability of your cluster, use separate physical hosts for
these cluster machines.
endif::ibm-z[]
====

The bootstrap and control plane machines must use {op-system-first} as the operating system. However, the compute machines can choose between {op-system-first} or {op-system-base-full} 7.9.

ifndef::openshift-origin[]
Note that {op-system} is based on {op-system-base-full} 8 and inherits all of its hardware certifications and requirements.
endif::[]
See link:https://access.redhat.com/articles/rhel-limits[Red Hat Enterprise Linux technology capabilities and limits].

ifdef::vsphere[]
[IMPORTANT]
====
All virtual machines must reside in the same datastore and in the same folder as the installer.
====
endif::vsphere[]


[id="network-connectivity_{context}"]
== Network connectivity requirements

All the {op-system-first} machines require network in `initramfs` during boot to fetch Ignition config files from the Machine Config Server.
ifndef::ibm-z[]
During the initial boot, the machines require either a DHCP server or that static IP addresses be set in order to establish a network connection to download their Ignition config files.
endif::ibm-z[]
ifdef::ibm-z[]
The machines are configured with static IP addresses. No DHCP server is required.
endif::ibm-z[]
Additionally, each {product-title} node in the cluster must have access to a Network Time Protocol (NTP) server.
ifndef::ibm-z[]
If a DHCP server provides NTP servers information, the chrony time service on the {op-system-first} machines read the information and can sync the clock with the NTP servers.
endif::ibm-z[]

ifdef::ibm-z[]
[id="ibm-z-network-connectivity_{context}"]
== IBM Z network connectivity requirements

To install on IBM Z under z/VM, you require a single z/VM virtual NIC in layer 2 mode. You also need:

*   A direct-attached OSA or RoCE network adapter
*   A z/VM VSwitch set up. For a preferred setup, use OSA link aggregation.
endif::ibm-z[]

[id="minimum-resource-requirements_{context}"]
== Minimum resource requirements

Each cluster machine must meet the following minimum requirements:

.Minimum resource requirements
[cols="2,2,2,2,2,2",options="header"]
|===

|Machine
|Operating System
ifndef::bare-metal[]
|vCPU ^[1]^
|Virtual RAM
endif::bare-metal[]
ifdef::bare-metal[]
|CPU ^[1]^
|RAM
endif::bare-metal[]
|Storage
ifndef::ibm-z[]
|IOPS ^[2]^
endif::ibm-z[]
ifdef::ibm-z[]
|IOPS
endif::ibm-z[]

|Bootstrap
|{op-system}
ifdef::ibm-power[|2]
ifndef::ibm-power[|4]
|16 GB
|100 GB
ifndef::ibm-z[]
|300
endif::ibm-z[]
ifdef::ibm-z[]
|N/A
endif::ibm-z[]


|Control plane
|{op-system}
ifdef::ibm-power[|2]
ifndef::ibm-power[|4]
|16 GB
|100 GB
ifndef::ibm-z[]
|300
endif::ibm-z[]
ifdef::ibm-z[]
|N/A
endif::ibm-z[]

ifndef::openshift-origin[]
|Compute
ifdef::ibm-z,ibm-power[|{op-system}]
ifndef::ibm-z,ibm-power[|{op-system} or RHEL 7.9]
|2
|8 GB
|100 GB
ifndef::ibm-z[]
|300
endif::ibm-z[]
ifdef::ibm-z[]
|N/A
endif::ibm-z[]
endif::openshift-origin[]

ifdef::openshift-origin[]
|Compute
ifdef::ibm-z,ibm-power[|{op-system}]
ifndef::ibm-z,ibm-power[|{op-system}]
|2
|8 GB
|100 GB
ifndef::ibm-z[]
|300
endif::ibm-z[]
ifdef::ibm-z[]
|N/A
endif::ibm-z[]
endif::openshift-origin[]
|===
[.small]
--
ifdef::ibm-z[]
1. One vCPU is equivalent to one physical core when simultaneous multithreading (SMT), or hyperthreading, is not enabled. When enabled, use the following formula to calculate the corresponding ratio: (threads per core × cores) × sockets = vCPUs.
endif::ibm-z[]
ifdef::bare-metal[]
1. One CPU is equivalent to one physical core when simultaneous multithreading (SMT), or hyperthreading, is not enabled. When enabled, use the following formula to calculate the corresponding ratio: (threads per core × cores) × sockets = CPUs.
endif::bare-metal[]
ifndef::ibm-z,bare-metal[]
1. One vCPU is equivalent to one physical core when simultaneous multithreading (SMT), or hyperthreading, is not enabled. When enabled, use the following formula to calculate the corresponding ratio: (threads per core × cores) × sockets = vCPUs.
endif::ibm-z,bare-metal[]
ifndef::ibm-z[]
2. {product-title} and Kubernetes are sensitive to disk performance, and faster storage is recommended, particularly for etcd on the control plane nodes which require a 10 ms p99 fsync duration. Note that on many cloud platforms, storage size and IOPS scale together, so you might need to over-allocate storage volume to obtain sufficient performance.
endif::ibm-z[]
--

ifeval::["{context}" == "installing-ibm-z"]
:!ibm-z:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-z"]
:!ibm-z:
endif::[]
ifeval::["{context}" == "installing-ibm-power"]
:!ibm-power:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-ibm-power"]
:!ibm-power:
endif::[]
ifeval::["{context}" == "installing-bare-metal"]
:!bare-metal:
endif::[]
ifeval::["{context}" == "installing-bare-metal-network-customizations"]
:!bare-metal:
endif::[]
ifeval::["{context}" == "installing-restricted-networks-bare-metal"]
:!bare-metal:
endif::[]
