// This module is included in the following assemblies:
// * about/op-release-notes.adoc

:_content-type: REFERENCE
[id="op-release-notes-1-12_{context}"]
= Release notes for {pipelines-title} General Availability 1.12

With this update, {pipelines-title} General Availability (GA) 1.12 is available on {OCP} 4.12 and later versions.

[id="new-features-1-12_{context}"]
== New features

In addition to fixes and stability improvements, the following sections highlight what is new in {pipelines-title} 1.12:

[NOTE]
====
Before upgrading to the {pipelines-title} Operator 1.12, ensure that you have at least installed the {OCP} 4.12.19 or 4.13.1 version on your cluster.
====

[id="pipelines-new-features-1-12_{context}"]
=== Pipelines

* With this update, the web console includes a new gauge metric for pipeline runs and task runs. This metric indicates whether the underlying pods are being throttled by {OCP} either because of resource quota policies defined in the namespace or because of resource constraints on the underlying node.

* With this update, the new `set-security-context` feature flag is set to `true` by default, in order to enable task runs and pipeline runs to run in namespaces with restricted pod security admission policies.

* With this update, the `enable-api-fields` flag is set to `beta` by default. You can use all features that are marked as `beta` in the code without further changes.

* With this update, the `results.tekton.dev/\*` and `chains.tekton.dev/*` reserved annotations are not passed from the pipeline run to the task runs that it creates.

* Before this update, CSI volumes and projected volumes were not enabled by default. With this update, you can use CSI volumes and projected volumes in your pipelines without changing any configuration fields.

* With this update, the isolated workspaces feature is enabled by default. You can use this feature to share a workspace with specified steps and sidecars without sharing it with the entire task run.

[id="operator-new-features-1-12_{context}"]
=== Operator

* With this update, you can configure the default security context constraint (SCC) for the pods that {pipelines-shortname} creates for pipeline runs and task runs. You can set the SCC separately for different namespaces and also configure the maximum (least restrictive) SCC that can be set for any namespace.

* With this update, a new `options:` heading is available under each component in the TektonConfig spec. You can use parameters under this headings to control settings for different components. In particular, you can use parameters under the `platforms.openshift.pipelinesAsCode.options.configMaps.pac-config-logging.data` spec to set logging levels for components of {pac}.

* With this update, you can use the new `spec.pipeline.performance.replicas` parameter to set the number of replicas that are created for the {pipelines-shortname} controller pod. If you previously set the replica counts in your deployment manually, you must now use this setting to control the replica counts.

* With this update, the Operator ensures that the stored API version remains the same throughout your deployment of {pipelines-shortname}. The stored API version in {pipelines-shortname} 1.12 is `v1`.

* With this update, you can use a secret to configure S3 bucket storage to store {tekton-results} logging information. When configuring S3 bucket storage, you must provide the secret with the S3 storage credentials by using the new `secret_name` spec in the `TektonResult` custom resource (CR).

[id="tekton-results-new-features-1-12_{context}"]
=== {tekton-results}

:FeatureName: Tekton Results
include::snippets/technology-preview.adoc[]

* With this update, you can configure {tekton-results} to store data in an external PostgreSQL server.

* With this update, you can use Google Cloud Storage (GCS) to store {tekton-results} logging information. You can provide the secret with the GCS storage credentials and then provide the secret name, secret key, and bucket name in properties under the `TektonResult` spec.  You can also use Workload Identity Federation for authentication.

* With this update, any service account authenticated with {pipelines-shortname} can access the `TektonResult` CR.

* With this update, {tekton-results} includes cluster role aggregation for service accounts with admin, edit, and view roles. Cluster role binding is no longer required for these service accounts to access results and records using the {tekton-results} API.

* With this update, you can configure pruning for each `PipelineRun` or `TaskRun` resource by setting a `prune-per-resource` boolean field in the `TektonConfig` CR. You can also configure pruning for each `PipelineRun` or `TaskRun` resource in a  namespace by adding the `operator.tekton.dev/prune.prune-per-resource=true` annotation to that namespace.

* With this update, if there are any changes in the {OCP} cluster-wide proxy, Operator Lifecycle Manager (OLM) recreates the {pipelines-title} Operator.
* With this update, you can disable the pruner feature by setting the value of the `config.pruner.disabled` field to `true` in the `TektonConfig` CR.

[id="triggers-new-features-1-12_{context}"]
=== Triggers

* With this update, you can configure readiness and liveness probes on `Trigger` CRs. You can also set the value of the failure threshold for the probes; the default value is 3.

* With this update, {pipelines-shortname} triggers add `Type` and `Subject` values when creating a response to a Cloud Events request.

[id="cli-new-features-1-12_{context}"]
=== CLI

* With this update, the `tkn pipeline logs` command displays the logs of a pipeline or task that is referenced using a resolver.

* With this update, when entering the `tkn bundle push` command, you can use the `--annotate` flag to provide additional annotations.

[id="pac-new-features-1-12_{context}"]
=== {pac}

* With this update, a {pac} pipeline run can include remote tasks fetched from multiple {artifact-hub} or {tekton-hub} instances and from different catalogs in the same hub instance.

* With this update, you can use parameters under the `platforms.openshift.pipelinesAsCode.options.configMaps.pac-config-logging.data` spec in the `TektonConfig` CR to set logging levels for {pac} components.

* With this update, you can set policies that allow certain actions only to members of a team and reject the actions when other users request them. Currently, the `pull_request` and `ok_to_test` actions support setting such policies.

* With this update, you can pass arbitrary parameters in the incoming webhook as a JSON payload. {pipelines-shortname} passes these parameters to the pipeline run. To provide an additional security layer, you must explicitly define the permitted parameters in the `Repository` CR.

* With this update, matching a large set of pipeline runs with a large number of remote annotations in {pac} is optimized. {pac} fetches the remote tasks only for the pipeline run that has matched.

* With this update, you can use the `source_url` variable in a pipeline run template to retrieve information about the forked repository from where the event, such as a pull or push request, is triggered.
+
.Example usage
[source,yaml]
----
apiVersion: tekton.dev/v1beta1
kind: PipelineRun
# ...
spec:
  params:
    - name: source_url
      value: "{{ source_url }}"
  pipelineSpec:
    params:
      - name: source_url
# ...
----

* With this update, if an authorized user provides an `ok-to-test` comment to trigger a pipeline run on the pull request from an unauthorized user and then the author makes further changes to the branch, {pac} triggers the pipelines. To disable triggering the pipeline until an authorized user provides a new `ok-to-test` comment, set the `pipelinesAsCode.settings.remember-ok-to-test` spec in the `TektonConfig` CR to false.

* With this update, on the GitHub status check page, the table that shows the status of all tasks includes the display name of every task.

* With this update, you can configure the `tags push` event in a pipeline run on GitLab.

* With this update, you can use the `target_url` and `source_url` fields in {pac} Common Expression Language (CEL) expression filtering annotations to filter the request for a specific target or source.

* With this update, when you configure fetching a remote GitHub URL using a token, you can include a branch name that contains a slash. You must encode the slash within the branch name as `%2F` to ensure proper parsing by {pac}, as in the following example URL: `\https://github.com/organization/repository/blob/feature%2Fmainbranch/path/file`. In this example URL, the branch name is `feature/mainbranch` and the name of the file to fetch is `/path/file`.

* With this update, you can use `--v1beta1` flag in the `tkn pac resolve` command. Use this flag if the pipeline run is generated with the `v1beta1` API version schema.

[id="breaking-changes-1-12_{context}"]
== Breaking changes

* With this update, you cannot use the `openshift-operators` namespace as the target namespace for installing {pipelines-shortname}. If you used the `openshift-operators` namespace as the target namespace, change the target namespace before upgrading to {pipelines-title} Operator version 1.12. Otherwise, after the upgrade, you will not be able to change any configuration settings in the `TektonConfig` CR except the `targetNamespace` setting.

* With this update, the new `spec.pipeline.performance.replicas` parameter controls the number of replicas that is created for every pod for a pipeline run or task run. If you previously set the replica counts in your deployment manually, after upgrading to {pipelines-shortname} version 1.12 you must use this parameter to control the replica counts.

* With this update, the following parameters are no longer supported in the `TektonResult` CR:
** `db_user`
** `db_password`
** `s3_bucket_name`
** `s3_endpoint`
** `s3_hostname_immutable`
** `s3_region`
** `s3_access_key_id`
** `s3_secret_access_key`
** `s3_multi_part_size`
+
You must provide these parameters using secrets. After upgrading to {pipelines-shortname} version 1.12, you must delete and re-create the `TektonResult` CR to provide these parameters.

* With this update, the `tkn pac bootstrap` command supports the `--github-hostname` flag. The `--github-api-url` flag is deprecated.

[id="known-issues-1-12_{context}"]
== Known issues

* If limit ranges are configured for a namespace, but pod ephemeral storage is not configured in the limit ranges, pods can go into an error stage with the message `Pod ephemeral local storage usage exceeds the total limit of containers 0`.

* If you want to make changes to the configuration in the `TektonResult` CR, you must delete the existing `TektonResult` CR and then create a new one. If you change an existing `TektonResult` CR, the changes are not applied to the existing deployment of {tekton-results}. For example, if you change the connection from an internal database server to an external one or vice versa, the API remains connected to the old database.

[id="fixed-issues-1-12_{context}"]
== Fixed issues

* Before this update, {pac} ran pipeline runs based only on branch base names, and could  incorrectly trigger pipeline runs with the same base name but different branch name. With this update, {pac} checks both the base name and the exact branch name of a pipeline run.

* Before this update, an incoming webhook event could trigger multiple pipeline runs configured for other events. With this update, an incoming webhook event triggers only a pipeline run configured for the webhook event.

* With this update, the `pac-gitauth` secrets are now explicitly deleted when cleaning up a pipeline run, in case the `ownerRef` on the pipeline run gets removed.

* Before this update, when a task in a pipeline run failed with a reason message, the entire pipeline run failed with a `PipelineValidationFailed` reason. With this update, the pipeline run fails with the same reason message as the task that failed.

*  Before this update, the `disable-ha` flag value was not correctly passed to the Pipelines controller, and the high availability (HA) functionality was never enabled. With this update, you can enable the HA functionality by setting the value of the `disable-ha` flag in the `TektonConfig` CR to `false`.

* Before this update, the `skopeo-copy` cluster task would fail when attempting to copy images mentioned in  config map data. With this update, the `skopeo-copy` cluster task completes properly.

* With this update, a pipeline run automatically generated by the `tkn pac generate –language=java` command has correct annotations and parameter names.

* Before this update, only a user with the administrative permissions could successfully run the `tkn pac create repository` command. With this update, any authorized user can run the `tkn pac create repository` command.

* Before this update, the `/test <run-name>` and `/retest <run-name>` user comments, which specified a particular pipeline, did not trigger pipeline runs as expected. With this update, these comments trigger pipeline runs successfully.

* Before this update, if there were multiple pipeline runs in the `.tekton` folder with the `generateName` field and not the `Name` field, the pipeline runs failed. This update fixes the issue.

* Before this update, in {pac} when using GitLab, a pipeline run was triggered by any event in a merge request, including adding labels and setting status. With this update, the pipeline run is triggered only when there is an open, reopen, or push event. A comment containing the status of the checks is now posted on the merge request.

* Before this update, while a pipeline run was waiting for approval, the status of the check could be displayed as `skipped` in the checks section of GitHub and Gitea pull requests. With this update, the correct `pending approval` status is displayed.

* Before this update, the bundles resolver sometimes set the type to `Task` when attempting to retrieve a pipeline, leading to errors in retrieval. With this update, the resolver uses the correct type to retrieve a pipeline.

* This update fixes an error in processing the Common Expression Language (CEL) NOT operator when querying {tekton-results}.

* This update fixed a `404` error response that was produced in the {tekton-results} API when a `LIST` operation for records was requested and the specified result was `-`.

* Before this update, in an `EventListener` object, the `status.address.url` field was always set to the default port. With this update, the `status.address.url` field is set to match the port specified in the `spec.resources.kubernetesresource.serviceport` parameter.

* Before this update, if the GitHub API provided a paginated response, {pac} used only the first page of the response. With this update, all paginated responses are processed fully.

* Before this update, the {tekton-chains} controller crashed when the host address of KMS Hashicorp Vault was configured incorrectly or when {tekton-chains} was unable to connect to the KMS Hashicorp Vault. With this update, {tekton-chains} logs the connection error and does not crash.

[id="release-notes-1-12-1_{context}"]
== Release notes for {pipelines-title} General Availability 1.12.1

With this update, {pipelines-title} General Availability (GA) 1.12.1 is available on {OCP} 4.12 and later versions.

[id="fixed-issues-1-12-1_{context}"]
=== Fixed issues

* Before this update, if you configured {pac} with the custom console driver to output to a custom console, the {pac} controller crashed in certain cases. After you pushed changes to a pull request, the CI status check for this pull request could remain as `waiting for status to be reported` and the associated pipeline run did not complete. With this update, the {pac} controller operates normally. After you push changes to a pull request, the associated pipeline run completes normally and the CI status check for the pull request is updated.

* Before this update, when using {pac}, if you created an access policy on the `Repository` custom resource (CR) that did not include a particular user and then added the user to the `OWNER` file in the Git repository, the user would have no rights for the {pac} CI process. For example, if the user created a pull request into the Git repository. the CI process would not run on this pull request automatically. With this update, a user who is not included in the access policy on the `Repository` CR but is included in the `OWNER` file is allowed to run the CI process for the repository.

* With this update, the HTTP/2.0 protocol is not supported for webhooks. All webhook calls to {pipelines-title} must use the HTTP/1.1 protocol.

[id="release-notes-1-12-2_{context}"]
== Release notes for {pipelines-title} General Availability 1.12.2

With this update, {pipelines-title} General Availability (GA) 1.12.2 is available on {OCP} 4.12 and later versions.

[id="fixed-issues-1-12-2_{context}"]
=== Fixed issues

* Before this update, the generated Git secret for the latest pipeline run was deleted when the `max-keep-runs` parameter was exceeded. With this update, the Git secret is no longer deleted on the latest pipeline run.

* With this update, the S2I cluster task uses a General Availability container image.