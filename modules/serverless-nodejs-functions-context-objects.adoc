// Module included in the following assemblies
//
// * serverless/functions/serverless-developing-nodejs-functions.adoc

:_content-type: REFERENCE
[id="serverless-nodejs-functions-context-objects_{context}"]
= Node.js context objects

Functions are invoked by providing a `context` object as the first parameter. This object provides access to the incoming HTTP request information.

This information includes the HTTP request method, any query strings or headers sent with the request, the HTTP version, and the request body. Incoming requests that contain a `CloudEvent` attach the incoming instance of the CloudEvent to the context object so that it can be accessed by using `context.cloudevent`.

[id="serverless-nodejs-functions-context-objects-methods_{context}"]
== Context object methods

The `context` object has a single method, `cloudEventResponse()`, that accepts a data value and returns a CloudEvent.

In a Knative system, if a function deployed as a service is invoked by an event broker sending a CloudEvent, the broker examines the response. If the response is a CloudEvent, this event is handled by the broker.

.Example context object method
[source,javascript]
----
// Expects to receive a CloudEvent with customer data
function handle(context, customer) {
  // process the customer
  const processed = handle(customer);
  return context.cloudEventResponse(customer)
    .source('/handle')
    .type('fn.process.customer')
    .response();
}
----

[id="serverless-nodejs-functions-context-objects-cloudevent-data_{context}"]
== CloudEvent data

If the incoming request is a CloudEvent, any data associated with the CloudEvent is extracted from the event and provided as a second parameter. For example, if a CloudEvent is received that contains a JSON string in its data property that is similar to the following:

[source,json]
----
{
  "customerId": "0123456",
  "productId": "6543210"
}
----

When invoked, the second parameter to the function, after the `context` object, will be a JavaScript object that has `customerId` and `productId` properties.

.Example signature
[source,javascript]
----
function handle(context, data)
----

The `data` parameter in this example is a JavaScript object that contains the `customerId` and `productId` properties.

[id="serverless-nodejs-functions-context-objects-arbitrary-data_{context}"]
== Arbitrary data

A function can receive any data, not just `CloudEvents`. For example, you might want to call a function by using POST with an arbitrary object in the body:

[source,json]
----
{
  "id": "12345",
  "contact": {
    "title": "Mr.",
    "firstname": "John",
    "lastname": "Smith"
  }
}
----

In this case, you can define the function as follows:

[source,javascript]
----
function handle(context, customer) {
  return "Hello " + customer.contact.title + " " + customer.contact.lastname;
}
----

Supplying the contact object to the function would then return the following output:

[source,text]
----
Hello Mr. Smith
----

[id="serverless-nodejs-functions-context-objects-supported-data-types_{context}"]
== Supported data types

CloudEvents can contain various data types, including JSON, XML, plain text, and binary data. These data types are provided to the function in their respective formats:

* *JSON Data*: Provided as a JavaScript object.
* *XML Data*: Provided as an XML document.
* *Plain Text*: Provided as a string.
* *Binary Data*: Provided as a Buffer object.

[id="serverless-nodejs-functions-context-objects-multiple-data-types-in-a-function_{context}"]
== Multiple data types in a function

Ensure your function can handle different data types by checking the Content-Type header and parsing the data accordingly. For example:

[source,javascript]
----
function handle(context, data) {
  if (context.headers['content-type'] === 'application/json') {
    // handle JSON data
  } else if (context.headers['content-type'] === 'application/xml') {
    // handle XML data
  } else {
    // handle other data types
  }
}
----
