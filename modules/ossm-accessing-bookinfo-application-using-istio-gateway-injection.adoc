:_mod-docs-content-type: Procedure
[id="ossm-accessing-bookinfo-application-using-istio-gateway-injection"]
= Accessing the Bookinfo application by using Istio gateway injection
:context: ossm-accessing-bookinfo-application-using-istio-gateway-injection

Gateway injection uses the same mechanisms as {istio} sidecar injection to create a gateway from a `Deployment` resource that is paired with a `Service` resource. The `Service` resource can be made accessible from outside an {ocp-product-title} cluster.

.Prerequisties

* You are logged in to the {ocp-product-title} web console as `cluster-admin`.

* The {SMProductName} Operator must be installed.

* The {istio} resource must be deployed. 

.Procedure

. Create the `istio-ingressgateway` deployment and service by running the following command at the CLI:
+
[source,terminal]
----
$ oc apply -n bookinfo -f ingress-gateway.yaml
----
+
[NOTE]
====
This example uses a sample `ingress-gateway.yaml` https://raw.githubusercontent.com/istio-ecosystem/sail-operator/main/chart/samples/ingress-gateway.yaml[file] that is available in the Istio community repository. 
====

. Configure the `bookinfo` application to use the new gateway by applying the gateway configuration: 
+
[source,terminal]
----
$ oc apply -f https://raw.githubusercontent.com/istio/istio/master/samples/bookinfo/networking/bookinfo-gateway.yaml -n bookinfo
----
+
[NOTE]
====
To configure gateway injection with the `bookinfo` application, this example uses a sample gateway configuration file that must be applied in the namespace where the application is installed.
====

. Use a route to expose the gateway external to the cluster:
+
[source,terminal]
----
$ oc expose service istio-ingressgateway -n bookinfo
----

. Automatically scale the pod when ingress traffic increases. This example sets the minimum replicas to `2` and the maximum replicas to `5`. It also creates another replica when utilization reaches 80%.
+
[source,yaml]
----
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  labels:
    istio: ingressgateway
    release: istio
  name: ingressgatewayhpa
  namespace: istio-ingress
spec:
  maxReplicas: 5
  metrics:
  - resource:
      name: cpu
      target:
        averageUtilization: 80
        type: Utilization
    type: Resource
  minReplicas: 2
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: istio-ingressgateway
----

. Specify the minimum number of pods that must be running on the node. This example ensures one replica is running if a pod gets restarted on a new node.
+
[source,yaml]
----
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  labels:
    istio: ingressgateway
    release: istio
  name: ingressgatewaypdb
  namespace: istio-ingress
spec:
  minAvailable: 1
  selector:
    matchLabels:
      istio: ingressgateway
----

. Obtain the gateway host name and the URL for the product page:
+
[source,terminal]
----
$ HOST=$(oc get route istio-ingressgateway -o jsonpath='{.spec.host}' -n bookinfo)
$ echo productpage URL: http://$HOST/productpage
----

. Verify that the `productpage` is accessible from a web browser.